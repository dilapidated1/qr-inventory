<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>QR Inventory Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: sans-serif; text-align: center; padding: 20px; }
  video { width: 100%; max-width: 400px; margin-top: 20px; }
  #result { margin-top: 20px; font-size: 18px; font-weight: bold; }
</style>
</head>
<body>

<h1>à¸ªà¹à¸à¸™ QR à¸ªà¸´à¸™à¸„à¹‰à¸²</h1>
<button id="start-scan">à¹€à¸£à¸´à¹ˆà¸¡à¸ªà¹à¸à¸™</button>
<video id="preview"></video>
<div id="result"></div>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
const API_KEY = "AIzaSyANSLF9ZbqIer2GF3BAyeAqtEcnIBIIEjs";
const SHEET_ID = "19uv_v8gBmUsORuXqPzhdMfT2WEXnnI8DNxuR0JY75pI";
const SHEET_RANGE = "Sheet1!A:C"; // à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ: à¸£à¸«à¸±à¸ªà¸ªà¸´à¸™à¸„à¹‰à¸² | Location | à¸ˆà¸³à¸™à¸§à¸™

document.getElementById("start-scan").addEventListener("click", () => {
    const html5QrCode = new Html5Qrcode("preview");
    html5QrCode.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        (decodedText) => {
            html5QrCode.stop();
            searchProduct(decodedText.trim());
        },
        (errorMessage) => {}
    ).catch(err => {
        document.getElementById("result").innerHTML = "à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸›à¸´à¸”à¸à¸¥à¹‰à¸­à¸‡à¹„à¸”à¹‰: " + err;
    });
});

function searchProduct(code) {
    document.getElementById("result").innerHTML = "à¸à¸³à¸¥à¸±à¸‡à¸„à¹‰à¸™à¸«à¸²: " + code + "...";
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_RANGE}?key=${API_KEY}`;
    fetch(url)
        .then(res => res.json())
        .then(data => {
            if (!data.values) {
                document.getElementById("result").innerHTML = "à¹„à¸¡à¹ˆà¸à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸™ Google Sheet";
                return;
            }
            const rows = data.values;
            const found = rows.find(row => row[0] === code);
            if (found) {
                document.getElementById("result").innerHTML =
                    `ğŸ“¦ à¸£à¸«à¸±à¸ª: ${found[0]}<br>ğŸ“ Location: ${found[1]}<br>ğŸ“Š à¸ˆà¸³à¸™à¸§à¸™: ${found[2]}`;
            } else {
                document.getElementById("result").innerHTML = "âŒ à¹„à¸¡à¹ˆà¸à¸šà¸£à¸«à¸±à¸ªà¸™à¸µà¹‰à¹ƒà¸™à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥";
            }
        })
        .catch(err => {
            document.getElementById("result").innerHTML = "à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”: " + err;
        });
}
</script>

</body>
</html>
